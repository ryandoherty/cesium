<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" 
   "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<title>Cesium</title>
<link rel="stylesheet" type="text/css" href="/site_media/css/reset-min.css" />
<link rel="stylesheet" type="text/css" href="site_media/css/fonts-min.css" />
<link rel="stylesheet" type="text/css" href="site_media/css/ui-lightness/jquery-ui-1.7.1.custom.css" />
<link rel="stylesheet" type="text/css" href="/site_media/css/index.css" />
</head>
<body>
<center>
<div id="header">
<h1>Cesium</h1>
<div id="linkbar">
<a href="/">Dashboard</a>
<a href="sites/">Sites</a>
<a href="tests/">Tests</a>
</div>
</div>
<div id="content">
{% if rows %}
{% load extra_tags %}
{% for row in rows %}
    <div class="row" id="row{{ forloop.counter0 }}">
    {% for site_id in row %}
    <div class="grid_square" id="square{{ forloop.parentloop.counter0|mult:"3"|add:forloop.counter0 }}">
    <div class="graph_container" id="container{{ site_id }}">
		<div class="site_label">
            {{ site_map|lookup:site_id }}
        </div>
		<div class="graph" id="site_graph{{ site_id }}"></div>
	</div>
    </div>
    {% endfor %}
    </div>
{% endfor %}
{% else %}
<p>You have no Sites to display.</p>
{% endif %}
</div>
</center>
<div id="tooltip" class="hidden"></div>
</body>
<script type="text/javascript" src="/site_media/js/jquery-1.3.2.min.js"></script>
<script type="text/javascript" src="/site_media/js/flot/jquery.flot.js"></script>
<script type="text/javascript" src="/site_media/js/jquery-ui-1.7.1.custom.min.js"></script>
<script type="text/javascript" src="/site_media/js/jquery.cookie.js"></script>
<script type="text/javascript" src="/site_media/js/index.js"></script>
<script type="text/javascript">
$(document).ready(function () {
    // graph data
    var data = {{ json_graph_data|safe }} 
    
    // object for page effects
    pagefx = new PageFX();
    
    // displays the graphs
    for (var site_id in data) {
        for (var pair in data[site_id])
            data[site_id][pair][0] *= 1000;
        $.plot($('div#site_graph'+site_id), 
			[data[site_id]],
			{	
				xaxis: { mode: "time" },
				yaxis: { min: 0.0, max: 100.0 },
                minTickSize: [1, "day"],
                lines: { show: true, color: "#000000", fill: true, fillColor: "rgba(102, 255, 102, 0.8)" },
				points: { show: true, fill: true},
				grid: { hoverable: true, backgroundColor: "#cc3333" },
				colors: ["#000000"]
		});
        
        // for tooltip on hover
        $("div#site_graph"+site_id).bind("plothover", 
            function (event, pos, item) {
                if (item) {
                    if (previousPoint != item.datapoint)
                    {    
                        previousPoint = item.datapoint;
                        point = item.datapoint[1].toFixed(2);
                        pagefx.showTooltip(item.pageX, item.pageY, point);
                    }
                }
                else
                {
                    pagefx.hideTooltip();
                    previousPoint = null;
                }
            });
	}

    pagefx.bindEffects();
});
</script>
</html>
